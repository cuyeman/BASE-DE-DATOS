----------------------------
--EJECUTAR CON SYSTEM
----------------------------


--CREACION DE USUARIOS
ALTER SESSION SET "_ORACLE_SCRIPT"= TRUE;
--CREACIÓN USUARIO DBADMIN
CREATE USER DBADMIN IDENTIFIED BY PWCONTRA
TEMPORARY TABLESPACE "TEMP";
ALTER USER DBADMIN QUOTA UNLIMITED ON USERS;
--CREACIÓN USUARIO ING_DATOS
CREATE USER ING_DATOS IDENTIFIED BY PWCONTRA
TEMPORARY TABLESPACE "TEMP";
ALTER USER ING_DATOS QUOTA UNLIMITED ON USERS;
--CREACIÓN USUARIO CLIENTE
CREATE USER USR_CLIENTE IDENTIFIED BY PWCONTRA
TEMPORARY TABLESPACE "TEMP";
ALTER USER USR_CLIENTE QUOTA UNLIMITED ON USERS;

--ASIGNACION DE PERMISOS

GRANT "CONNECT" TO DBADMIN, ING_DATOS, USR_CLIENTE;
--PERMISOS EXCLUSIVOS DE DBADMIN
GRANT "RESOURCE" TO DBADMIN;
GRANT CREATE ANY INDEX TO DBADMIN;
GRANT CREATE SYNONYM TO DBADMIN;
GRANT CREATE PUBLIC SYNONYM TO DBADMIN;

--PERMISOS EXCLUSIVOS DEL INGENIERO DE DATOS
GRANT CREATE ANY VIEW TO ING_DATOS;
GRANT CREATE MATERIALIZED VIEW  TO ING_DATOS;
GRANT CREATE SYNONYM TO ING_DATOS;
GRANT "RESOURCE" TO ING_DATOS;

--PERMISOS EXCLUSIVOS DEL USR_CLIENTE
GRANT CREATE ANY VIEW TO USR_CLIENTE;
GRANT CREATE MATERIALIZED VIEW  TO USR_CLIENTE;



----------------------------
--EJECUTAR CON DBADMIN
----------------------------

--CREACIÓN DINÓNIMOS PÚBLICOS
CREATE PUBLIC SYNONYM syn_camion FOR camion;
CREATE PUBLIC SYNONYM syn_cliente FOR cliente;
--CREACIÓN SINÓNIMOS PRIVADOS
CREATE  SYNONYM syn_comuna FOR comuna;
CREATE  SYNONYM syn_estado_civil FOR estado_civil;

--OTORGAR PERMISOS AL INGENIERO DE DATOS

GRANT SELECT ON syn_camion TO ING_DATOS;
GRANT SELECT ON syn_cliente TO ING_DATOS;
GRANT SELECT ON DBADMIN.syn_comuna TO ING_DATOS;
GRANT SELECT ON DBADMIN.syn_estado_civil TO ING_DATOS;

--OTORGAR PERMISOS AL USUARIO CLIENTE
GRANT SELECT ON syn_camion TO USR_CLIENTE;
GRANT SELECT ON syn_cliente TO USR_CLIENTE;
GRANT SELECT ON DBADMIN.syn_comuna TO USR_CLIENTE;
GRANT SELECT ON DBADMIN.syn_estado_civil TO USR_CLIENTE;

--CREACIÓN DE ÍNDICES
CREATE INDEX idx_INICIAL_PNOMBRE_L on cliente (lower(substr(PNOMBRE_CLI,1,1)));
CREATE INDEX idx_dvrun on cliente (DVRUN_CLI);

SELECT PNOMBRE_CLI||' '|| SNOMBRE_CLI||' '|| APPATERNO_CLI ||' '||APMATERNO_CLI AS NOMBRE_COMPLETO
,PNOMBRE_CLI
,DVRUN_CLI
FROM CLIENTE
WHERE lower(substr(PNOMBRE_CLI,1,1))='m'
--and DVRUN_CLI='5'
ORDER BY 1;



----------------------------
--EJECUTAR CON ING_DATOS
----------------------------
--COMPROBAR PERMISOS DE ACCESOS SOBRE SINÓNIMOS PÚBLICO SY PROIVADOS

SELECT * FROM DBADMIN.syn_estado_civil;
SELECT * FROM syn_cliente;
SELECT * FROM DBADMIN.syn_comuna;
SELECT * FROM syn_camion;

----------

SELECT SYN_CLI.PNOMBRE_CLI NOMBRE_CLIENTE
,SYN_EC.NOMBRE_ESTADO_CIVIL ESTADO_CIVIL
,SYN_CLI.FECHA_NAC_CLI FECHA_NACIMINTO
,(EXTRACT (YEAR FROM SYSDATE))-( EXTRACT (YEAR FROM SYN_CLI.FECHA_NAC_CLI)) EDAD_CLIENTE
, CASE 
    WHEN (EXTRACT (YEAR FROM SYSDATE))-( EXTRACT (YEAR FROM SYN_CLI.FECHA_NAC_CLI))>40
    THEN 10000
    ELSE 0
    END BONO
FROM syn_cliente SYN_CLI JOIN DBADMIN.syn_estado_civil SYN_EC ON(SYN_CLI.ID_ESTADO_CIVIL = SYN_EC.ID_ESTADO_CIVIL)
ORDER BY SYN_CLI.FECHA_NAC_CLI DESC
;




SELECT PNOMBRE_CLI||' '|| SNOMBRE_CLI||' '|| APPATERNO_CLI ||' '||APMATERNO_CLI AS NOMBRE_COMPLETO
,PNOMBRE_CLI
,DVRUN_CLI
FROM syn_cliente
WHERE lower(substr(PNOMBRE_CLI,1,1))='m'
--and DVRUN_CLI='5'
ORDER BY 1;



----------------------------
--EJECUTAR CON USR_CLIENTE
----------------------------

CREATE  VIEW VISTA_BONOS_CLIENTES AS 
SELECT SYN_CLI.PNOMBRE_CLI NOMBRE_CLIENTE
,SYN_EC.NOMBRE_ESTADO_CIVIL ESTADO_CIVIL
,SYN_CLI.FECHA_NAC_CLI FECHA_NACIMINTO
,(EXTRACT (YEAR FROM SYSDATE))-( EXTRACT (YEAR FROM SYN_CLI.FECHA_NAC_CLI)) EDAD_CLIENTE
, CASE 
    WHEN (EXTRACT (YEAR FROM SYSDATE))-( EXTRACT (YEAR FROM SYN_CLI.FECHA_NAC_CLI))>40
    THEN 10000
    ELSE 0
    END BONO
FROM syn_cliente SYN_CLI JOIN DBADMIN.syn_estado_civil SYN_EC ON(SYN_CLI.ID_ESTADO_CIVIL = SYN_EC.ID_ESTADO_CIVIL)
ORDER BY SYN_CLI.FECHA_NAC_CLI DESC
WITH READ ONLY;